#N canvas 592 67 565 620 16;
#X declare -lib Gem;
#X declare -lib iemmatrix;
#X obj 9 -1 gemhead;
#X obj 9 29 pix_video;
#X obj 9 539 pix_texture;
#X obj 203 223 pix_blob;
#X obj 9 569 rectangle 4 3;
#X text 369 65 window:;
#X text 369 45 video monitor;
#X obj 371 167 gemwin;
#X msg 381 126 destroy;
#X msg 371 96 create \, 1;
#X obj 99 79 alpha;
#X obj 99 109 pix_movement 0.2;
#X floatatom 89 304 3 0 100 2 threshold - -;
#X obj 89 331 / 100;
#X msg 89 362 treshold \$1;
#X floatatom 221 304 3 0 100 2 blobsize - -;
#X obj 221 331 / 100;
#X msg 221 362 blobSize \$1;
#N canvas 585 213 450 300 showblobs 0;
#X obj 67 113 route 1 2 3 4 5 6;
#N canvas 0 22 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 58 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 76 286 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 85 unpack;
#X obj 102 108 * 8;
#X obj 102 131 - 4;
#X obj 145 106 * 8;
#X obj 145 129 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 67 136 pd showblob;
#N canvas 0 22 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 58 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 76 286 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 85 unpack;
#X obj 102 108 * 8;
#X obj 102 131 - 4;
#X obj 145 106 * 8;
#X obj 145 129 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 86 155 pd showblob;
#N canvas 0 22 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 58 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 76 286 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 92 unpack;
#X obj 102 115 * 8;
#X obj 102 138 - 4;
#X obj 145 113 * 8;
#X obj 145 136 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 105 174 pd showblob;
#N canvas 0 22 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 58 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 76 286 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 85 unpack;
#X obj 102 108 * 8;
#X obj 102 131 - 4;
#X obj 145 106 * 8;
#X obj 145 129 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 124 193 pd showblob;
#N canvas 0 22 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 60 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 76 286 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 85 unpack;
#X obj 102 108 * 8;
#X obj 102 131 - 4;
#X obj 145 106 * 8;
#X obj 145 129 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 143 212 pd showblob;
#N canvas 537 164 451 339 showblob 0;
#X obj 76 184 gemhead;
#X obj 76 266 translateXYZ;
#X obj 102 58 pack;
#X obj 102 34 inlet x|y;
#X obj 76 225 color 1 1 1;
#X obj 219 75 loadbang;
#X obj 219 122 random 256;
#X obj 219 143 / 256;
#X obj 219 185 hsv2rgb;
#X msg 219 166 \$1 1 1;
#X obj 219 97 t b b;
#X obj 81 308 sphere 0.2;
#X msg 249 233 0;
#X msg 216 233 0.2;
#X obj 216 254 f;
#X obj 298 47 t b;
#X obj 298 24 inlet reset;
#X obj 139 183 t f b;
#X obj 102 85 unpack;
#X obj 102 108 * 8;
#X obj 102 131 - 4;
#X obj 145 106 * 8;
#X obj 145 129 - 4;
#X connect 0 0 4 0;
#X connect 1 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 1 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 7 0 9 0;
#X connect 8 0 4 1;
#X connect 9 0 8 0;
#X connect 10 0 6 0;
#X connect 10 1 12 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 14 0 11 1;
#X connect 15 0 12 0;
#X connect 16 0 15 0;
#X connect 17 0 1 2;
#X connect 17 1 13 0;
#X connect 18 0 19 0;
#X connect 18 1 21 0;
#X connect 19 0 20 0;
#X connect 20 0 1 1;
#X connect 21 0 22 0;
#X connect 22 0 17 0;
#X restore 162 231 pd showblob;
#X obj 67 86 inlet blobinformation;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 0 2 3 0;
#X connect 0 3 4 0;
#X connect 0 4 5 0;
#X connect 0 5 6 0;
#X connect 7 0 0 0;
#X restore 236 455 pd showblobs;
#X obj 369 -4 import Gem;
#N canvas 366 23 698 824 pix_blobtracker 0;
#N canvas 0 22 571 399 matrix->indexlist 0;
#X obj 133 90 inlet;
#X obj 133 298 outlet;
#X obj 133 163 mtx;
#X msg 133 137 row;
#X obj 133 109 t b a b;
#X obj 212 227 i;
#X obj 239 228 + 1;
#X obj 133 248 pack 0 0 0 0;
#X obj 133 210 t l b;
#X msg 133 273 \$4 \$1 \$2 \$3;
#X msg 228 206 0;
#X msg 133 189 \$1 \$2 \$3;
#X connect 0 0 4 0;
#X connect 2 0 11 0;
#X connect 3 0 2 0;
#X connect 4 0 3 0;
#X connect 4 1 2 1;
#X connect 4 2 10 0;
#X connect 5 0 6 0;
#X connect 5 0 7 3;
#X connect 6 0 5 1;
#X connect 7 0 9 0;
#X connect 8 0 7 0;
#X connect 8 1 5 0;
#X connect 9 0 1 0;
#X connect 10 0 5 1;
#X connect 11 0 8 0;
#X restore 411 688 pd matrix->indexlist;
#X obj 17 197 inlet gemlist;
#X obj 17 742 outlet gemlist;
#X obj 431 519 t a;
#X obj 431 393 t a a;
#X obj 458 650 outlet numblobs;
#X obj 411 589 t a a;
#X obj 458 621 mtx_size;
#X obj 431 433 mtx_resize \$1 2;
#N canvas 0 22 669 614 mtx_matcher 0;
#X obj 61 220 mtx_distance2;
#X obj 61 176 t a a;
#X obj 61 314 t a a;
#X obj 61 395 outlet matched;
#X obj 241 395 outlet matcher;
#X obj 188 177 inlet dest;
#X obj 61 149 inlet source;
#X text 25 105 both "source" and "dest" must have the same number of
columns (dimension in feature-space);
#N canvas 0 22 622 378 mtx_rowpermutate 0;
#X obj 169 194 t b a;
#X obj 169 225 mtx;
#X obj 111 142 mtx_pivot -1;
#X text 17 19 this unfortunately does not guarantee to give as a minimum
trace of the result!;
#X obj 169 289 outlet rowpermutator;
#X obj 111 91 inlet permutans;
#X obj 169 256 mtx_mul;
#X text 67 327 TWEAKED PATCH: Juan Ignacio Mendoza Garay - 2016;
#X connect 0 0 1 0;
#X connect 0 1 6 1;
#X connect 1 0 6 0;
#X connect 2 1 0 0;
#X connect 2 2 1 1;
#X connect 5 0 2 0;
#X connect 6 0 4 0;
#X restore 61 271 pd mtx_rowpermutate;
#X text 34 433 this algorithm is _far_ from being perfect! the [mtx_rowpermutate]
does not really guarantee that the trace of the result is a global
mimimum \; if it is not \, than the match will be sub-optimal! this
will be even worse \, if there are several _equal_ (sub)minima in the
distance-matrix.;
#X text 198 211 greater distances have an extra penalty (^2) \; is
this ok?;
#X text 22 52 we calculate the euclidean distance between the vectors
of the 2 sets and try to find a trace with minimum penalty;
#X text 22 12 this tries to get the best (weighted) match between 2
sets of feature-vectors.;
#X obj 61 359 mtx_mul;
#X text 87 579 TWEAKED PATCH: Juan Ignacio Mendoza Garay - 2016;
#X connect 0 0 8 0;
#X connect 1 0 0 0;
#X connect 1 1 13 1;
#X connect 2 0 13 0;
#X connect 2 1 4 0;
#X connect 5 0 0 1;
#X connect 6 0 1 0;
#X connect 8 0 2 0;
#X connect 13 0 3 0;
#X restore 431 487 pd mtx_matcher;
#X text 11 114 this blobtracker is far from being perfect. for an explanation
read the comments in [pd mtx_matcher];
#X text 12 66 copyright (c) IOhannes m zmoelnig \, 2005 \; you may
use this under the terms of the GnuGPL v0.2;
#X text 83 716 we don't want to output "matrix" \, but pure pd-lists
instead;
#X obj 411 746 outlet bloblists;
#X text 34 487 this is the work-horse for the tracking;
#X text 15 10 part of Gem;
#X text 12 29 depends on "Gem" and "iemmatrix";
#X text 21 243 the work-horse for detection;
#X obj 531 214 loadbang;
#X obj 531 243 f \$1;
#X obj 531 272 moses 1;
#X msg 578 393 6 2;
#X obj 531 301 t b b;
#X text 10 155 TODO: output only those blobs that are really detected
;
#X obj 431 362 mtx_resize \$1 0;
#X msg 578 332 6 0;
#X obj 17 269 pix_multiblob \$1;
#X obj 512 21 import iemmatrix;
#X obj 411 568 mtx_mul;
#X text 105 783 TWEAKED PATCH: Juan Ignacio Mendoza Garay - 2016;
#X obj 474 208 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X connect 0 0 13 0;
#X connect 1 0 26 0;
#X connect 3 0 9 1;
#X connect 4 0 8 0;
#X connect 4 1 28 1;
#X connect 6 0 0 0;
#X connect 6 1 7 0;
#X connect 7 0 5 0;
#X connect 8 0 9 0;
#X connect 9 0 3 0;
#X connect 9 1 28 0;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 20 0 22 0;
#X connect 21 0 8 1;
#X connect 22 0 21 0;
#X connect 22 1 25 0;
#X connect 24 0 4 0;
#X connect 25 0 24 1;
#X connect 26 0 2 0;
#X connect 26 1 24 0;
#X connect 28 0 6 0;
#X connect 30 0 19 0;
#X restore 89 416 pd pix_blobtracker;
#X connect 0 0 1 0;
#X connect 1 0 20 0;
#X connect 2 0 4 0;
#X connect 8 0 7 0;
#X connect 9 0 7 0;
#X connect 10 0 11 0;
#X connect 12 0 13 0;
#X connect 13 0 14 0;
#X connect 14 0 20 0;
#X connect 15 0 16 0;
#X connect 16 0 17 0;
#X connect 17 0 20 0;
#X connect 20 0 2 0;
#X connect 20 1 18 0;
